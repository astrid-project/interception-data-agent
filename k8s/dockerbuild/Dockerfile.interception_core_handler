FROM alpine:latest
LABEL maintainer="Guerino Lamanna - guerino.lamanna@infocomgenova.it"
LABEL version="0.1"
LABEL description="Interception Core Handler"
WORKDIR /root/interception_core_handler

ENV LOGGERLEVEL="DEBUG"
ENV INTERFACE="eth0"
ENV INTERCEPTIONPATH="./interceptions/"
ENV RESTSERVERADDRESS="0.0.0.0"
ENV RESTSERVERPORT="5003"
ENV POLYCUBEADDRESS="127.0.0.1"
ENV POLYCUBEPORT="9000"
ENV KAFKAADDRESS="0.0.0.0"
ENV KAFKAPORT="5002"
ENV KAFKATOPIC="interception"
ENV LOGSTASHADDRESS="127.0.0.1"
ENV LOGSTASHMSGPORT="5959"
ENV LOGSTASHDATAPORT="5960"
ENV LOGSTASHVERSION="1"
ENV LOGVOIPPATH="./"
ENV LOGVOIPFILENAME="containerLogs.log"
ENV LOGVOIPREADINGTIME="0.5"
ENV POLYCUBEISENABLED="false"
ENV LIBPCAPISENABLED="true"
ENV TCPSERVERADDRESS=""
ENV TCPSERVERPORT="0"

ADD ./interception-data-agent/interception_core_handler /root/interception_core_handler

RUN apk add python3
RUN apk add py3-pip
RUN apk add tcpdump
RUN pip3 install -r ./requirements.txt

ENTRYPOINT ./scripts/configure.sh -d $LOGGERLEVEL -i $INTERFACE -p $INTERCEPTIONPATH -a $RESTSERVERADDRESS -b $RESTSERVERPORT -e $POLYCUBEADDRESS -f $POLYCUBEPORT -g $KAFKAADRESS -k $KAFKAPORT -w $KAFKATOPIC -l $LOGSTASHADDRESS -n $LOGSTASHMSGPORT -c $LOGSTASHDATAPORT -s $LOGSTASHVERSION -m $LOGVOIPPATH -o $LOGVOIPFILENAME -t $LOGVOIPREADINGTIME -u $POLYCUBEISENABLED -z $LIBPCAPISENABLED -q $TCPSERVERADDRESS -r $TCPSERVERPORT ; ./scripts/run.sh;


